classdef MIdata_loader
    % Loads BICM curves
    % (c) 2011 by INTHFT
    % www.nt.tuwien.ac.at
    
    properties
    end
    
    methods
        function MI_data = MIdata_load(obj,varargin)
            % Loads the BICM capacity curves. The optional input parameter allows you
            % to set whether the data will be loaded from a file (true) or from the
            % code below (by default).
            
            if isempty(varargin)
                load_BICM_data = @obj.load_BICM_data_not_from_file;
                load_k_d_data  = @obj.load_k_d_not_from_file;
            else
                load_from_file = varargin{1};
                if load_from_file
                    load_BICM_data = @obj.load_BICM_data_from_file;
                    load_k_d_data  = @obj.load_k_d_from_file;
                else
                    load_BICM_data = @obj.load_BICM_data_not_from_file;
                    load_k_d_data  = @obj.load_k_d_not_from_file;
                end
            end
            
            % 4-QAM data
            MI_data(1) = load_BICM_data(4);
            
            % 16-QAM data
            MI_data(2) = load_BICM_data(16);
            I = (diff(MI_data(2).BICM) < 0.000001);
            [~,MI_data(2).sat_SNR] = max(I);
            
            % 64-QAM data
            MI_data(3) = load_BICM_data(64);
            
            % lines through BICM at different CQI values
            [MI_data(1).k MI_data(1).d] = load_k_d_data();
        end
        
        % This function loads the BICM curve data from previously-stored results
        function [MI_data] = load_BICM_data_not_from_file(obj,mod_order)
            switch mod_order
                case 4
                    % 4-QAM
                    snr  = [-20,-19,-18,-17,-16,-15,-14,-13,-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30;];
                    I_mp = [0.0145040798142417;0.0180495670169318;0.0225386425773571;0.0280602389238496;0.0358578968290610;0.0451426899555016;0.0562457052984886;0.0696440118783448;0.0889549190024954;0.109262305665228;0.139543165213463;0.169799326545321;0.216072211578717;0.259788752475173;0.321131380937433;0.399751533319607;0.479761105275129;0.586377337604963;0.695761853330924;0.826137007093301;0.981522921203667;1.11967676562909;1.28841983749518;1.44451625406681;1.58255477046833;1.72047842641293;1.83047847728280;1.89177504966431;1.95023598269586;1.98296540986833;1.99313345369930;1.99873710332633;1.99976907011738;1.99999635358345;1.99993226915515;1.99999999989961;2.00000000000000;2;2;2;2;2;2;2;2;2;2;2;2;2;2;];
                case 16
                    % 16-QAM
                    snr  = [-20,-19,-18,-17,-16,-15,-14,-13,-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30;];
                    I_mp = [0.0115015850479105;0.0145213602714502;0.0181261085639286;0.0225060213378363;0.0285820469476965;0.0356522189865092;0.0456828080106737;0.0570605796163974;0.0721923736984040;0.0889423336813087;0.111651179839417;0.137248244195541;0.176917090349613;0.220151742838056;0.273834281324814;0.337983588319050;0.419807069819132;0.509198171932364;0.621235592966039;0.751950510874458;0.900331391651303;1.07553962850269;1.26375445129337;1.45025685753565;1.68835323428355;1.92608548087069;2.17629893006362;2.42357615225952;2.68109835943718;2.92646996912064;3.16608925638382;3.38389188032557;3.58571859893810;3.72922044238501;3.84523331542033;3.92666066622156;3.96744855659789;3.98687172991945;3.99815525172531;3.99925373177403;3.99980039328101;3.99999998537774;3.99999999999597;4.00000000000000;4;4;4;4;4;4;4;];
                case 64
                    % 64-QAM
                    snr  = [-20,-19,-18,-17,-16,-15,-14,-13,-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30;];
                    I_mp = [0.0107961407205783;0.0135322795703052;0.0173207594495590;0.0211236242001327;0.0275190491003867;0.0352102034987238;0.0434134788175848;0.0559370189097299;0.0667365269773992;0.0850062029762153;0.109417329687807;0.134299756800402;0.171792663017621;0.203730688306440;0.256553343417094;0.324658625384422;0.400051417901143;0.481356942340842;0.597545230860789;0.692440083567457;0.855260429860519;1.01325030493850;1.18920697023229;1.38278445253677;1.59367134131826;1.82169909211708;2.06492711403885;2.30605296060873;2.61313993545321;2.84179568206980;3.19197124316595;3.49914309694359;3.78245888484253;4.12100252378270;4.35424615027644;4.70581953950149;4.96396617180687;5.25824543613679;5.43474545288685;5.65386375686052;5.81714390759308;5.89973733863853;5.96344534033110;5.97947970668534;5.99765947781893;5.99972417519190;5.99996945622025;5.99999992196427;5.99999999946799;5.99999999999998;6;];
                otherwise
                    error('This BICM data is not supported');
            end
            
            MI_data.SNR = 10.^(linspace(snr(1),snr(end),1000)/10);
            MI_data.BICM = interp1(snr,I_mp,10*log10(MI_data.SNR));
            MI_data.max_SNR = max(MI_data.SNR);
            MI_data.min_SNR = min(MI_data.SNR);
            [~,MI_data.sat_SNR] = max(MI_data.BICM);
        end
        
        % This function loads the BICM curve data from previously-stored results
        function [MI_data] = load_BICM_data_from_file(obj,mod_order)
            switch mod_order
                case 4
                    % 4-QAM
                    BICM_data = load('./+network_elements/MI_data/BICMC_4.mat','snr','I_mp');
                case 16
                    % 16-QAM
                    BICM_data = load('./+network_elements/MI_data/BICMC_16.mat','snr','I_mp');
                case 64
                    % 64-QAM
                    BICM_data = load('./+network_elements/MI_data/BICMC_64.mat','snr','I_mp');
                otherwise
                    error('This BICM data is not supported');
            end
            snr  = BICM_data.snr;
            I_mp = BICM_data.I_mp;
            MI_data.SNR = 10.^(linspace(snr(1),snr(end),1000)/10);
            MI_data.BICM = interp1(snr,I_mp,10*log10(MI_data.SNR));
            MI_data.max_SNR = max(MI_data.SNR);
            MI_data.min_SNR = min(MI_data.SNR);
            [~,MI_data.sat_SNR] = max(MI_data.BICM);
        end
        
        function [k d] = load_k_d_not_from_file(obj)
            k = [0,0.0523000000000000,0.0672000000000000,0.112350000000000,0.183600000000000,0.250000000000000,0.287100000000000,0.299800000000000,0.369150000000000,0.464850000000000,0.408200000000001,0.457999999999999,0.585900000000001,0.600550000000000,0.606450000000000,0.515650000000001;];
            d = [0.100000000000000,0.100000000000000,0.0950333333333333,0.0298666666666668,-0.146466666666667,-0.381466666666666,-0.550699999999997,-0.622333333333332,-1.06188333333334,-1.78646666666667,-1.32350000000001,-1.76029999999999,-3.12653333333333,-3.29059999999999,-3.37021666666667,-2.15466666666669;];
        end
        
        function [k d] = load_k_d_from_file(obj)
            k_d_data = load('./+network_elements/MI_data/BICM_k_d_MSE.mat','k','d');
            k = k_d_data.k;
            d = k_d_data.d;
        end
    end
end

